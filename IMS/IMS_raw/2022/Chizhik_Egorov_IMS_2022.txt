Мультимодальные интеллектуальные ассистенты 
для оформления первичного приема пациента
А.В. Чижик, М.П. Егоров
Введение
Системы здравоохранения по всему миру претерпевают значительную цифровую трансформацию, внедряются различные медицинские технологии с использованием искусственного интеллекта. Разработчики стараются создать механизмы, способные снизить рутинную нагрузку на медицинских работников, помочь врачам в принятии решений, а также обеспечить своевременный доступ к информации и сервисам для пациентов [1]. Использование компьютерных и телекоммуникационных технологий для обмена медицинской информацией объединилось в общий подход, получивший название телемедицина. Развитие ИКТ позволяет проводить часть коммуникативных взаимодействий с пациентами в дистанционном формате, а также разгружать колл-центры и регистратуры, используя для сбора необходимой для приема информации диалоговые интерфейсы (чат-боты) [2, 3].
Сам концепт телемедицины (использование автоматизации и ИИ для взаимодействия «клиника-пациент») не является новым, однако пандемия COVID-19 стала фактором, повлиявшим на стремительное развитие телемедицинских технологий. Использование технологии телемедицины может привести к справедливому распределению специализированной медицинской помощи [4].
Существует множество факторов, влияющих на успешное внедрение и эффективность телемедицины как базиса eHealth. Так поддержание высокого уровня оказываемой медицинской помощи в условиях «дистанционной медицины» и получение удовлетворительных исходов лечения зависит от уровня осведомленности пациентов и медперсонала о легитимном контуре функционирования телемедицины на уровне законодательной базы (правовая база в области здравоохранения) и технологических ограничений (ограничения существующих алгоритмов машинного обучения и других используемых методов, ограничения медицинской системы в контексте сценариев взаимодействия с пациентами, ограничения со стороны медицинских информационных систем) [5].
Основной целью телемедицины сегодня является разработка инструментов и технологий телемедицины следующего поколения [6]. Это подразумевает преодоление географических и временных барьеров между службами здравоохранения и их пользователями, а также улучшение работы алгоритмов машинного обучения, которые направлены на улучшение взаимодействия между специалистами и пациентами (что подразумевает переход от экстренного оказания медицинской помощи к профилактическим мерам, а это возможно только на основе управления взаимодействием на данных).
Многие больницы и системы здравоохранения используют автоматизацию, чтобы облегчить проблему нехватки персонала и эффективно управлять и сортировать пациентов в больших масштабах. Одним из видов автоматизации являются чат-боты и связанные с ними технологии, которые могут автоматизировать процесс приема симптомов, а также всплывать на поверхность и выдавать материалы.
Хорошим примером интеграции чатботов в медицинскую систему является Northwell Health, система здравоохранения в Нью-Йорке, которая использует автоматические чаты, чтобы помочь своим лечащим бригадам оставаться на связи с пациентами во время их выздоровления после выписки из больницы.
Пациенты взаимодействуют с цифровым помощником, который выходит на связь с пациентами от имени клиники. Он задает вопросы об их состоянии здоровья и лечении, а также может считывать биометрические данные с устройств. Чатбот анализирует ответы пациентов в режиме реального времени и рекомендует пациенту, что делать дальше, чтобы повысить вероятность выздоровления. Если бот определяет, что пациент нуждается в дополнительной помощи, он направляет его в клинику, переводя пациента на телемедицинский визит или на колл-центр записи на личный прием.
Отметим также, что существуют социологические исследования [7, 8], которые демонстрируют возросшую рутинную офисную нагрузку на врачей, что влечет за собой профессиональное выгорание: каждый пятый врач и две из пяти медсестер говорят, что из-за этого оставят свою профессию в течение двух лет. Чат-боты и технологии, основанные на данных, могут облегчить нагрузку на врачей, медсестер и других медицинских работников при сборе симптомов и других данных, автоматизируя задачи, которые лучше подходят для компьютера, и высвобождая медицинские бригады для работы с максимальной отдачей.
Существует ряд проблем при внедрении человеко-машинного диалога в повседневные практики взаимодействия клиник и пациентов. Одна из этих проблем – отсутствие желания со стороны пользователей взаимодействовать со сценариями, основанными на правилах (так как это означает не эмпатичный диалог, а также ощущение отсутствия возможности отклонения от сценария, заложенного создателями интерфейса). Поэтому привлекательной выглядит идея создания чат-бота с открытым доменом, который бы мог взаимодействовать с юзером в формате естественного диалога, не теряя при этом функциональной составляющей.
1. Постановка проблемы
При разработке чат-ботов с открытым доменом (особенно это касается тем, которые связаны с социально важными сферами, где ошибка стоит дорого) есть две основные проблемы. Первая проблема – способность понимания естественного языка, т. е. бот достаточно точно должен понимать реплики пользователя на естественном языке. Вторая проблема – извлечение соответствующей информации из базы данных для конкретной предметной области, т.е. генерация ответов для обратной связи с пациентом.
Понимание естественного языка — это задача, с которой ИИ не может справиться в полной мере, поэтому она сводится к обнаружению намерений пользователя. Если входящая реплика обработана достаточно успешно и намерение определено, то наступает не менее сложный момент взаимодействия с набором данных, в котором хранятся данные, необходимые для ответа. Ответ должен быть достаточно правильным (и наполненным смыслом) для задачи, решаемой пользователем. Оценка корректности ответа бота связана не только с прямым взаимодействием «реплика поиск релевантности в наборе данных», но и с созданием определенных протоколов поведения бота (сценариев). Например, в нынешней концепции правовой системы ИИ не может давать никаких рекомендаций без участия врача. Это означает, что намерение «получить информацию» должно в некоторых случаях привести к переключению на регистратуру поликлиники.
Таким образом, наша проблема – идентификация и анализ намерений пользователя для проектирования эмпатичного чат-бота. Иными словами, нам видится перспективным создать алгоритм взаимодействия с пользователем, в результате которого будет возможно определить намерение пациента (достаточно быстро и точно), что впоследствии поможет включить корректный сценарий взаимодействия с человеком.
2. Данные
Собранные для нашего эксперимента данные представляют из себя таблицу вида «болезнь-набор симптомов». Для первичного исследования выбрано пять заболеваний: «аппендицит», «холицестит», «эзофагит», «энтерит», «язва». 
На рис. 1 отображена статистика по распределению количества симптомов.
Рис.1. Распределение количества симптомов
3. Методы и сценарии
3.1.	Определение намерения пользователя
Диалоговые агенты можно разделить на два типа: с присутствие функционала для решения одной конкретной задачи (или нескольких, но, тем не менее, речь идет о конечном числе сценариев, с которыми знакома разрабатываемая система) и разговорные интерфейсы без ориентации на решение задач (в таком случае речь идет о поддержании диалога на естественном языке) [9]. Диалоговые системы, ориентированные на задачи, помогают пользователям выполнить конкретную задачу. Диалоговые системы, не ориентированные на задачи, предназначены для предоставления разумных ответов пользователям и, таким образом, для развлечения и диалогов с открытым доменом. 
Задача, которую пытаемся решить мы сводится к попытке объединения этих двух типов чат-ботов, что позволит оставаться в контексте решения индивидом задачи, но при этом в атмосфере естественно выглядящего диалога (внутри которого, в частности, ИИ сможет определить, хочет ли пользователь в моменте достичь решения проблемы или просто развлекается, также это поможет собрать о пациенте информацию). Такая концепция предполагает, что намерение пользователя необходимо определить не более чем за 3 попытки [10]. 
В соответствии с [11] и [12], нужно учитывать, что существуют короткие вопросы (один вопрос ведет к получению целевой информации) и вопросы, которые предполагают развитие в виде каскада дополнительных уточнений (постепенное узнавание проблемы). Также в исследовании [13] высказано предположение, что диалог с ботом может зайти в тупик при рассинхронизации мотивации пользователя и тех сценариев, которые были заложены в бота (с идейной точки зрения), так как при этом наступает эмоциональное раздражение и апатия, соответствующие желанию завершить диалог.
Из этого следует, что в любой момент общения пациента с ассистентом, нужно добавить функцию обращения к реальному человеку или выбору из определенных вариантов.
Нами определены три типа намерений пользователя: «получение справки», «запись к врачу» и «режим болталки». Также нами была поставлена задача предварительного определения болезни, что может быть хорошим кейсом для регистратуры клиники (получать первичные данные пациента с маркировкой предположений по срочности приема и т.д.).
В результате был разработан следующий метод (рис. 2).
Рис. 2. Метод определения намерения пользователя
Метод предполагает наличие размеченного датасета с примерами реплик, которые ведут к определенным сценариям. Для сбора необходимых текстовых образцов на естественном языке нами использовались открытые данные: блоги, в которых задаются вопросы о здоровье, сайты клиник (вкладка «вопрос-ответ») и социальные сети. Собранные тексты были предобработаны: удалены стоп-слова, специальные символы, проведена лемматизация слов. Далее была проведена векторизация текстов с помощью метода Word2Vec, так как данный алгоритм учитывает семантику слов, что понадобилось нам в будущем. В нашем случае, вектор предложения есть средний вектор его слов. 
Попадая в алгоритм, реплика пользователя сравнивается с теми, что содержатся в размеченном датасете. Для классификации рассчитывается косинусное расстояние между вектором поступившей фразы и векторами предложений, содержащихся в нашей базе. Определив, к какому интенту (классу) относится заданный пользователем вопрос, алгоритм включает соответствующий режим.
На текущем этапе разработки мы добавили дополнительный шаг. Пациенту предлагается указать, верно ли модель поняла его мотив. Фиксация этого факта служит способом обогащения базы реплик (и инструментом улучшение способа разметки собранных данных). 
3.2.	Обоснование необходимости режима «болталки»
Людям не нравится, когда они общаются с ботом, который имеет легко считываемый шаблонный сценарий. Эти вопросы поднимаются, например, в работе [14]. Действительно, это достаточно очевидный факт: мотивационная модель к использованию приложения должна строиться на гипотезе, что человек может решить любую (не типовую) проблему с его использованием. Это значит, что от ИИ (или любой другой технологии) ждут поведение, схожего с живым человеком. 
Поэтому возникает гипотеза, что добавление функции разговора увеличит удовлетворенность пользователей. При этом с функциональной точки зрения это означает, что алгоритм должен понимать по фразе пользователя, что пора переключится именно в режим болтания. На данный момент есть огромное количество открытых моделей, которые имитируют общение между людьми. Например, алгоритм DialogFlow, который умеет поддерживать общение на ежедневные темы.
3.3.	Запись к врачу
Один из важных кейсов, который мы стремимся интегрировать в функционал бота – запись к врачу. На наш взгляд, в задачи чат-бота должна входить оценка срочности записи к врачу (это может решаться шаблонным и прямым вопросом, заданным пациенту). При обозначенной со стороны юзера несрочности, со стороны бота предполагается активировать сценарий сбора симптомов для предварительного определения болезни. Это полезно с двух позиций: 1. сбор симптомов сам по себе является полезной опцией, которая сразу может отправляться на сервер и вписываться в соответствующие слоты карты больного (таким образом, можно разгрузить рутинные действия, которые на данный момент лежат на врачах, ведущих прием); 2. концепт «второе мнение», который может быть использован как принимающим врачом, так и учитываться в регистратуре (ведь собственная оценка самочувствия может быть неточной, и весьма вероятно, что срочность приема гораздо более актуальна для пациента, чем он предполагает).
3.4.	Предсказание болезни по набору симптомов
В качестве теоретической основы для понимания мотивации людей к использованию чат-ботов мы применяем Теорию использования и удовлетворения [15]. Теория предполагает, что пользователь мотивирован через свою цель и на этом основании происходит выбор определенного инструмента коммуникации на основе социальных и психологических потребностей. [16]. Очевидно, что чат-боты имеют ряд выраженных особенностей, которые привлекают людей в моменте выбора между ними и общением с регистратурой поликлиники (или другим релевантным сервисом). Так люди, предпочитающие воспользоваться взаимодействием с роботом, не хотят тратить много времени на диалог (и с интуитивной точки зрения кажется, что чат-бот решит проблему быстрее, чем оператор call-центра). Соответственно, при общении с ботами, люди предпочитают выдавать как можно меньше информации и им не нравятся прямые и односложные вопросы. 
Было проведено исследование [17], где прослеживается прямая зависимость между тем, насколько быстро бот понимает проблему пользователя и оценкой степени стиля виртуального ассистента с точки зрения социальной ориентированности. Иными словами, чат-бот тем больше напоминает человека с точки зрения эмпатии и полезности, чем меньше задает вопросов. Следовательно, разрабатываемая система должна собирать как можно меньше информации, но с другой стороны, ставить правильные диагнозы. Для этого можно отобрать несколько симптомов, которые описывают каждую болезнь по отдельности. 
Предложенный метод определения болезней по сообщениям пользователя детально рассматривается на рисунке 3.
Рис. 3. Метод определение болезни пациента
Во-первых, симптомы сначала нужно предобработать и векторизовать. Затем решается задача многоклассовой классификации с помощью модели логистической регрессии. После рассматривается важность (коэффициент) каждого отдельного признака для определения заболевания. Далее, для каждой болезни по отдельности, можно отобрать несколько наиболее важных признаков и обучить на них заново классификатор. Признаки, которые мы отберем, нужно будет искать в ответах пользователей. Если модель не будет уверена в ответе, то можно спросить у пользователя, есть ли у него определенный симптом, который ранее не упоминался и повторить работу модели уже с обновленными векторами. Далее со стороны алгоритма подготавливается отчет, объясняющий, почему предсказано конкретное заболевание.
4. Результаты
Лемматизация текстов для русского языка проводилась с помощью библиотеки pymorphy2. После стратифицированного разделения на 70% и 30% в тренирующую и валидационную выборку, доля верных ответов описанного выше алгоритма составила 83%.
Для решения задачи предсказания болезни по набору симптомов, векторизация проводилась с помощью bag-of-words для уно- и биграм. Рассматривался только факт вхождения токена (рис. 4) в текст. 
Рис. 4. Токены симптомов
Всего было найдено 3632 токенов. Данные были разделены в соотношении 70% и 30%, как тренировочная и валидационная выборка соответственно. Точность модели, как доля верных ответов, составила 83.7%. Было отобрано по 5 наиболее важных признаков для каждого заболевания (Рис. 5). 
Рис. 5. Коэффициенты наличия симптомов для каждой болезни
В итоге токенов стало 25, а точность модели упала до 69.8%. Тем не менее, при применении одного уточнения (добавление наиболее важного признака, который на данный момент отсутствует в тексте), точность модели составила 86.0%.
5. Рассуждения
Предложенный алгоритм определения заболевания был применен в контрольной выборке для 130 симптомов. К сожалению, даже с применением одного уточнения, модель имеет относительно низкую точность (86%). Это связано с тем, что алгоритм векторизации, представленный нами, учитывает только вхождение токенов. Кроме того, применяется один из самых простых алгоритмов предсказания (Logistic Regression). Тем не менее, данные допущения позволяют за меньшее количество данных, провести детальную интерпретацию.
Например, для болезни «холицестит» классификатор имеет большой вес перед симптомом «вздутие» (1.53), но с другой стороны, отрицательный вес перед признаком «боль живот» (-0.83) (Рис. 4). Это говорит о том, что если у пациента наблюдается боль в животе, то, скорее всего, это не «холицестит», и наоборот. Данный факт позволяет составлять человеко-читаемый отчет, благодаря которому, пациент и врач будут доверять работе модели и смогут незамедлительно начать процесс лечения.
Возможно, можно увеличить точность модели используя модели случайных деревьев. Так, случайный лес (max_depth=13) с одним уточнением показывает точность 91%. Проблемность этой стратегии заключается в интерпретации результатов (путь к листу с предсказанием и выбор глубины дерева). 
В будущем планируется увеличить количество разных заболеваний и тестовую выборку к ним. Для определения симптомов по тексту планируется добавить поиск конструкций, а не вхождения триггерных токенов, тем самым достичь точности предсказания в 93-97%.