РАЗРАБОТКА ЛИНГВИСТИЧЕСКОГО КОМПЛЕКСА
ДЛЯ МОРФОЛОГИЧЕСКОГО АНАЛИЗА
РУССКОЯЗЫЧНЫХ КОРПУСОВ ТЕКСТОВ НА ОСНОВЕ PYMORPHY И NLTK
1. Введение
Морфологическая аннотация и разрешение морфологической неоднозначности в корпусах текстов – задачи, имеющие множество решений, которые различаются по качеству и по трудоемкости. Особенно сложно решать данные задачи при автоматической обработке текстов флективных языков с развитой морфологией, каковыми, в частности, являются славянские языки, применительно к которым используются словарные, статистические и гибридные модели компьютерной морфологии (ср. [Garabík 2005, Hajič 2004; Hajič et al. 2001, Коваль 2005] и т.д.). Для русского языка широко используются разноплановые открытые инструменты морфологического анализа: основанные на компьютерной морфологической базе системы АОТ (http://www.aot. ru) [Сокирко 2004], mystem (https://tech.yandex.ru/mystem) [Segalovich 2003], использующие статистические алгоритмы парсеры TnT (http://www.coli.uni-saarland.de/~thorsten/tnt/), TreeTagger (http://www.cis.uni-muenchen.de/~schmid/tools/TreeTagger/) [Sharoff 2005], обеспечивающие точность разбора в пределах «baseline». Вместе с тем, существуют закрытые парсеры, обеспечивающие точность морфологического анализа более 95% [Protopopova, Bocharov 2013; Sokirko, Toldova 2005].
В отечественном лингвистическом сообществе действует форум, посвященный разработке стандартов морфологического анализа и оценке качества разрабатываемых морфологических парсеров [Ляшевская и др. 2010] – модулей, направленных на обработку всех цепочек слов в тексте и при этом учитывающих контекстную информацию (в частности, результаты разбора контекстных соседей). Принято различать два вида парсеров – сильные и слабые (предусматривающие / не предусматривающие разрешение морфологической неоднозначности). Наша задача – разработать сильный гибридный парсер для морфологического анализа русских текстов, совмещающий словарные данные и не один, а несколько статистических алгоритмов. 
В настоящем исследовании предлагается метод улучшения качества морфологического анализа русскоязычных текстов, предполагающий интеграцию нескольких открытых инструментов, а именно, морфоанализатора PyMorphy2 (http://pymorphy2. readthedocs.org/en/latest/) [Korobov 2015] и различных морфологических теггеров в составе библиотек NLTK (http://www.nltk. org/) [Bird et al. 2009]. Это первый опыт такого рода в компьютерной обработке русскоязычных корпусов текстов.
2. Используемые инструменты морфологического 
анализа
PyMorphy2 – морфологический анализатор русских текстов, который работает с морфологическим словарем OpenCorpora (http://opencorpora.org/), создаваемым на основе базы данных «Грамматического словаря русского языка» А.А. Зализняка [Зализняк 2003]. В PyMorphy2 также разрешено подключение пользовательских словарей. Алгоритм производит морфологический анализ с определением грамматических характеристик целевого слова и лемматизацией. При разборе несловарных словоформ используется предсказатель, объединяющий два алгоритма: предсказание по префиксу и по концу слова. PyMorphy2 может предлагать несколько вариантов разбора. Всем вариантам приписывается параметр score (P(tag|word)), который определяется по данным OpenCorpora. При необходимости выбора одного разбора из множества выбирается наиболее частотный разбор для данной словоформы в подкорпусе с разрешенной неоднозначностью . Таким образом, в PyMorphy2 при морфологическом анализе контекстная информация в явном виде не используется.
NLTK – специализированная среда для автоматической обработки текстов, созданная для работы с Python и оснащенная библиотеками и лингвистическими данными (корпусами и словарями). NLTK позволяет осуществлять полный цикл автоматической обработки текста (графематический анализ, токенизация, стемминг, лемматизация, морфологический анализ, фрагментационный анализ, построение синтаксических структур и логических форм для предложений во входном тексте), а также процедуры классификации и кластеризации. Предусмотрены средства для автоматического извлечения фактов и оценки тональности текстов, а также ряд других операций. 
Наш интерес к NLTK определяется богатством его ресурсов для морфологического анализа. Так, в NLTK имеются различные морфологические теггеры, опирающиеся на словари и/или контекстные данные: это теггер на регулярных выражениях, n-граммные теггеры, аффиксный теггер, теггер на скрытых марковских моделях, теггер Брилла. Эти теггеры можно использовать по отдельности или же в комбинации «основной теггер – бэк-офф теггер(ы)». До сих пор отсутствует широкодоступная адаптация NLTK для работы с русским языком. Наше исследование частично восполняет этот пробел.
3. Интеграция алгоритмов морфологического анализа в комплексе PyMorphy2+NLTK
Нами был разработан лингвистический комплекс, интегрирующий морфологический анализатор PyMorphy2 и теггеры NLTK в двух вариантах (далее PyMorphy2+NLTK).
1. Первый вариант обработки тестового корпуса производится с помощью PyMorphy2. Если PyMorphy2 дает несколько вариантов разбора, то происходит вызов биграммного теггера NLTK, который выбирает наилучший вариант разбора на основе тегов предшествующей словоформы: выбирается тот тег, который наиболее часто встречается последовательно в биграмме с предыдущим тегом в обучающей выборке. 
2. Второй вариант обработки производится с помощью теггеров NLTK: униграммного, биграммного и триграммного (http://www.nltk.org/api/nltk.tag.html#module-nltk.tag.sequential). Далее проводится доразметка тестового корпуса с учетом предсказаний PyMorphy2 тогда, когда отсутствует разбор в первой модели.
До настоящего времени ни один морфологический парсер для русского языка не предусматривал такую комбинацию алгоритмов.
4. Лингвистические данные
В тестировании комплекса PyMorphy2+NLTK использовался подкорпус OpenCorpora со снятой омонимией (объем примерно 6 тыс. предложений, 30 тыс. с/у) и две выборки из Национального корпуса русского языка (http://ruscorpora.ru/corpora-usage.htm) со снятой омонимией из подкорпуса художественных текстов (RNC-fiction) и публицистики (RNC-media). Подробные сведения об этих данных приведены в табл. 1.
Надо отметить, что принципы морфологической разметки используемых корпусов значительно отличаются. Кроме того, несмотря на то, что PyMorphy2 основывается на словаре OpenCorpora, некоторые теги в результатах работы морфоанализатора не совпадают со словарными. В связи с этим мы сопоставили разметку из трёх источников и разработали инструмент для приведения разметки обоих корпусов к формату PyMorphy2. 
Большая часть помет имеет однозначное соответствие. Граммемы из следующих категорий – род, число, падеж, одушевлённость, вид, время, переходность, лицо, наклонение – совпадают. Проанализированные нами различия в основном касаются описания специфических категорий (тип местоимения, описание существительных singularia и pluralia tantum), а также несловарных форм. Для приведения разметки к одному формату были оставлены только грамматические и лексико-грамматические категории.
5. Эксперименты по морфологическому анализу и оценка результатов тестирования комплекса PyMorphy2+NLTK
Для тестирования комплекса PyMorphy2+NLTK использовались комбинации обучающих и тестовых корпусов, указанные в табл. 2. В табл. 3–4 представлены результаты оценки двух вариантов интеграции морфоанализаторов. Нами оценивались следующие параметры: точность работы комплекса 1) на всех морфологических категориях и 2) на частеречной разметке. В табл. 3 приводится точность работы комплекса на всех морфологических категориях, в табл. 4 – точность работы комплекса на частеречной разметке. Для сравнения приводятся, во-первых, результаты тестирования модуля PyMorphy2 с внутренним алгоритмом снятия неоднозначности, основанном на статистике корпуса OpenCorpora. Далее в столбце PM-disamb мы указали результаты первого комбинированного подхода: использование PyMorphy2 с алгоритмом снятия неоднозначности на основе предыдущего тега. Затем в столбцах P1, P2, P3 приведены результаты второго комбинированного подхода, основанного на теггерах NLTK с доразметкой PyMorphy2.
Показатели точности в серии экспериментов по частеречной разметке располагаются в промежутке P = 90,0…95,8%. Наилучшие результаты были получены в экспериментах с подкорпусом публицистики (RNC-media). Значения точности в серии экспериментов со всеми морфологическими категориями находятся в промежутке P = 79,7…86,0%. Здесь наилучшие результаты были получены в экспериментах с подкорпусом художественных текстов (RNC-fiction).
Подробный анализ ошибок разбора представлен в статье [Паничева, Митрофанова 2015]. В настоящем эксперименте некоторые виды ошибок удалось исключить за счет приведения различных видов разметки к единому формату. Кроме того, можно отметить, что лучшие значения получаются при обучении и тестировании анализатора на корпусах одного жанра. Однако обучение на подкорпусе OpenCorpora также дает неплохие результаты, что, вероятно, подтверждает его сбалансированность, несмотря на небольшое количество предложений с полностью снятой морфологической неоднозначностью.
6. Оценка полученных результатов
Сравнение морфологических парсеров [Ляшевская и др. 2010] предполагает решение нескольких типов задач. Для сильных парсеров предусмотрены две дорожки: «Дизамбигуация: леммы» и «Дизамбигуация: частеречные теги». В нашем случае решается существенно более сложная задача, а именно, проводятся эксперименты по морфологическому анализу всего текста и разрешению неоднозначности по всей морфологической аннотации, включающей и теги лемм, и частеречные теги, и теги грамматических категорий.
В ходе соревнования морфологических парсеров был выработан стандарт морфологической разметки, при этом экспертная оценка точности ручной разметки эталонного корпуса такова: леммы – 94,4%, частеречные теги – 95,4%, теги грамматических категорий – 89,0%, вся морфологическая аннотация – 85,5%. В нашем случае (с изначально более жесткими условиями) точность разрешения неоднозначности по всей морфологической аннотации (86%) превышает точность разметки эталонного корпуса (85,5%). В варианте экспериментов по частеречной аннотации полученная нами точность достигает 95,8%, тогда как эталонные результаты составляют 95,4%. Эти наблюдения позволяют сделать заключение о том, что результаты работы комбинированного анализатора являются состоятельными и удовлетворяют высоким требованиям соревнования морфологических парсеров для русского языка. Более детальное сравнение нашего парсера и других имеющихся открытых ресурсов затруднено из-за различий во внутреннем устройстве этих систем, а также из-за различий в выборе обучающих и тестовых корпусов.
7. Заключение
В статье (1) дана характеристика основных инструментов морфологического анализа русских текстов, (2) представлена архитектура разрабатываемого лингвистического комплекса PyMorphy2+NLTK и входящие в него основные открытые алгоритмы, (3) описаны анализируемые подкорпусы текстов (OpenCorpora, RNC-fiction, RNC-media), (4) изложен ход экспериментов по обучению и тестированию комплекса, (5) предложена интерпретация полученных данных и дана оценка результатов. Можно утверждать, что использование комбинаций алгоритмов, реализованных в нашем комплексе, обеспечивает высокое качество разметки в том числе для таких типов текстов, которые значительно отличаются от корпуса OpenCorpora, используемого для внутренней настройки алгоритма PyMorphy2. Комбинирование алгоритмов позволяет также приблизить значение точности частеречной разметки к верхней границе для русскоязычных ресурсов (свыше 95%).
